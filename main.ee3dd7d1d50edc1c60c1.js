"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[179],{5718:(e,t,i)=>{var r=i(5812),s=(i(451),i(3227)),n=i(1622),o=i(1645),a=i(1203),h=i(5253),d=i(1605),y=i(3093),l=i(390);class u extends s.c{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=n.zw,this.myOnlineKeyboard=new n.cx(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new n.cx(o.CE.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0,this.willSaveReplay=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,o.CE.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=(0,a.w)(e,o.ay)}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.isFirstGame?(this.isFirstGame=!1,this.amIPlayer2=!o.CE.amICreatedRoom):o.CE.isQuickMatch&&(0,h.Ei)()),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.amIPlayer2=!this.amIPlayer2,(0,d.S)(o.CE.myNickname,this.amIPlayer2),(0,d.S)(o.CE.peerNickname,!this.amIPlayer2),(0,d.e)(o.CE.myPartialPublicIP,this.amIPlayer2),(0,d.e)(o.CE.peerPartialPublicIP,!this.amIPlayer2))}gameLoop(){o.CE.gameStartAllowed&&o.CE.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.willSaveReplay){const e=new l.P3;e.xDirection=this.keyboardArray[0].xDirection,e.yDirection=this.keyboardArray[0].yDirection,e.powerHit=this.keyboardArray[0].powerHit;const t=new l.P3;t.xDirection=this.keyboardArray[1].xDirection,t.yDirection=this.keyboardArray[1].yDirection,t.powerHit=this.keyboardArray[1].powerHit,y.Q.recordInputs(e,t)}if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>n.ID&&(this.myOnlineKeyboard.inputQueue.length>n.ID?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}else o.CE.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this)}}var c=i(5093),m=i(7495);const p=c.d.TEXTURES;p.WITH_COMPUTER=p.WITH_FRIEND;const b=r.Xd;b.RESOLUTION=window.devicePixelRatio,b.SCALE_MODE=r.aH.NEAREST,b.ROUND_PIXELS=!0;const I=r.e6({width:432,height:304,antialias:!1,backgroundColor:0,transparent:!1}),w=new r.W2,C=new r.vB,P=new r.aN;document.querySelector("#game-canvas-container").appendChild(I.view),I.render(w),P.add(c.d.SPRITE_SHEET);for(const e in c.d.SOUNDS)P.add(c.d.SOUNDS[e]);function E(){const e=new u(w,P.resources);(0,h.IW)(e,C),(0,m.IJ)(e),function(e){C.maxFPS=e.normalFPS,C.add((()=>{I.render(w),e.gameLoop()})),C.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");P.onProgress.add((()=>{t.style.width=`${P.progress}%`})),P.onComplete.add((()=>{e.classList.contains("hidden")||e.classList.add("hidden")}))}(),o.CE.callbackAfterDataChannelOpened=()=>{P.load(E)},(()=>{try{return window.self!==window.top}catch(e){return!0}})()&&(Array.from(document.getElementsByClassName("if-embedded-in-other-website")).forEach((e=>e.classList.remove("hidden"))),Array.from(document.querySelectorAll(".if-embedded-in-other-website button")).forEach((e=>e.addEventListener("click",(()=>{Array.from(document.getElementsByClassName("if-embedded-in-other-website")).forEach((e=>e.classList.add("hidden")))}))))),(0,h.yA)()}},e=>{e.O(0,[931,692],(()=>(5718,e(e.s=5718)))),e.O()}]);
//# sourceMappingURL=main.ee3dd7d1d50edc1c60c1.js.map