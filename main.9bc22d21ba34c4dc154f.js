(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{71:function(e,t,i){"use strict";i.r(t);var r=i(7),s=(i(23),i(39)),n=i(16),a=i(5),o=i(21),h=i(6),y=i(13),d=i(15),c=i(17);class u extends s.a{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=n.d,this.myOnlineKeyboard=new n.a(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new n.a(a.b.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0,this.willSaveReplay=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,a.b.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=Object(o.b)(e,a.a)}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.isFirstGame?(this.isFirstGame=!1,this.amIPlayer2=!a.b.amICreatedRoom):a.b.isQuickMatch&&Object(h.c)()),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.amIPlayer2=!this.amIPlayer2,Object(y.a)(a.b.myNickname,this.amIPlayer2),Object(y.a)(a.b.peerNickname,!this.amIPlayer2),Object(y.b)(a.b.myPartialPublicIP,this.amIPlayer2),Object(y.b)(a.b.peerPartialPublicIP,!this.amIPlayer2))}gameLoop(){a.b.gameStartAllowed&&a.b.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(!this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter))return void(a.b.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this));if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.willSaveReplay){const e=new c.b;e.xDirection=this.keyboardArray[0].xDirection,e.yDirection=this.keyboardArray[0].yDirection,e.powerHit=this.keyboardArray[0].powerHit;const t=new c.b;t.xDirection=this.keyboardArray[1].xDirection,t.yDirection=this.keyboardArray[1].yDirection,t.powerHit=this.keyboardArray[1].powerHit,d.a.recordInputs(e,t)}if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>n.c&&(this.myOnlineKeyboard.inputQueue.length>n.c?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}}var l=i(9),m=i(11);i(34);const p=l.a.TEXTURES;p.WITH_COMPUTER=p.WITH_FRIEND;const b=r.i;b.RESOLUTION=window.devicePixelRatio,b.SCALE_MODE=r.e.NEAREST,b.ROUND_PIXELS=!0;const I=r.h({width:432,height:304,antialias:!1,backgroundColor:0,transparent:!1}),O=new r.b,w=new r.g,P=new r.d;document.querySelector("#game-canvas-container").appendChild(I.view),I.render(O),P.add(l.a.SPRITE_SHEET);for(const e in l.a.SOUNDS)P.add(l.a.SOUNDS[e]);function g(){const e=new u(O,P.resources);Object(h.B)(e,w),Object(m.g)(e),function(e){w.maxFPS=e.normalFPS,w.add(()=>{I.render(O),e.gameLoop()}),w.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");P.onProgress.add(()=>{t.style.width=P.progress+"%"}),P.onComplete.add(()=>{e.classList.contains("hidden")||e.classList.add("hidden")})}(),a.b.callbackAfterDataChannelOpened=()=>{P.load(g)},Object(h.A)()}},[[71,0,2,1]]]);
//# sourceMappingURL=main.9bc22d21ba34c4dc154f.js.map